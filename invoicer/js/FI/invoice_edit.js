$(function(){$("#created_at").inputmask(datepickerFormat);$("#due_at").inputmask(datepickerFormat);$("textarea").autosize();$("#btn-add-tax").click(function(){$("#modal-placeholder").load(addTaxModalRoute,{invoice_id:invoiceId})});$("#btn-copy-invoice").click(function(){$("#modal-placeholder").load(copyInvoiceModalRoute,{invoice_id:invoiceId})});$("#btn-invoice-to-invoice").click(function(){$("#modal-placeholder").load(invoiceToInvoiceRoute,{invoice_id:invoiceId,client_id:clientId})});$("#btn-update-exchange-rate").click(function(){b()});$("#currency_code").change(function(){b()});function b(){$.post(getExchangeRateRoute,{currency_code:$("#currency_code").val()},function(c){$("#exchange_rate").val(c)})}$(".btn-save-invoice").click(function(){var d=[];var f=1;var e={};var c=$(this).data("apply-exchange-rate");$("table tr.item").each(function(){var g={};$(this).find("input,select,textarea").each(function(){if($(this).is(":checkbox")){if($(this).is(":checked")){g[$(this).attr("name")]=1}else{g[$(this).attr("name")]=0}}else{g[$(this).attr("name")]=$(this).val()}});g.item_order=f;f++;d.push(g)});$(".custom-form-field").each(function(){e[$(this).data("field-name")]=$(this).val()});$.post(invoiceUpdateRoute,{number:$("#number").val(),created_at:$("#created_at").val(),due_at:$("#due_at").val(),invoice_status_id:$("#invoice_status_id").val(),items:JSON.stringify(d),terms:$("#terms").val(),footer:$("#footer").val(),currency_code:$("#currency_code").val(),exchange_rate:$("#exchange_rate").val(),custom:JSON.stringify(e),apply_exchange_rate:c,template:$("#template").val()}).done(function(g){window.location=invoiceEditRoute}).fail(function(g){if(g.status==400){showErrors($.parseJSON(g.responseText).errors,"#form-status-placeholder")}else{alert(unknownError)}})});var a=function(f,c){var d=c.children();var g=c.clone();g.children().each(function(e){$(this).width(d.eq(e).width())});return g};$("#item-table tbody").sortable({helper:a})});